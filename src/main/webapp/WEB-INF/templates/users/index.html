<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">

<!-- <head th:include="fragments :: head"></head> -->

<head th:replace="fragments/head :: common_header(~{::title},~{::link})">

  <title>[[#{users.page.title}]]</title>

  <!-- FooTable -->
  <link th:href="@{/resources/css/plugins/footable/footable.core.css}" rel="stylesheet">
  
  <!-- Sweet Alert -->
  <link th:href="@{/resources/css/plugins/sweetalert/sweetalert.css}" rel="stylesheet">

</head>

<body>
<div id="wrapper">

	<!-- Main Navigation -->
	<nav th:replace="fragments :: navbar-static-side"></nav>
	
	<div id="page-wrapper" class="gray-bg">
		<!-- Minor Navigation -->
		<div th:replace="fragments :: navbar-static-top"></div>
		
		<!-- Title, Breadcrumb and Actions Navigation -->
		<div th:replace="fragments :: page-heading"></div>
		
		<!-- Main Content -->
		
		<div class="wrapper wrapper-content animated fadeInRight">

            <div class="row">
                <div class="col-lg-12">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <h5>Listagem de usuários</h5>

                            <div class="ibox-tools">
<!--                                 <a class="collapse-link"> -->
<!--                                     <i class="fa fa-chevron-up"></i> -->
<!--                                 </a> -->
                                <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                                    <i class="fa fa-wrench"></i>
                                </a>
                                <ul class="dropdown-menu dropdown-user">
                                    <li><a href="#">Config option 1</a>
                                    </li>
                                    <li><a href="#">Config option 2</a>
                                    </li>
                                </ul>
                                <a class="fullscreen-link">
                                <i class="fa fa-expand"></i>
                            </a>
                            </div>
                        </div>
                        <div class="ibox-content">

                            <table id="teste" class="footable table table-stripped toggle-arrow-tiny" data-page-size="10">
                                <thead>
                                <tr>

                                    <th data-toggle="true">Nome</th>
                                    <th>E-Mail</th>
                                    <th>Telefone</th>
                                    <th>Último Login</th>
                                    <th>Status</th>
                                    <th data-hide="all">Grupos</th>
                                    <th class="text-right">Action</th>
                                    
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="user : ${users}" th:onclick="'getRoles(\'' + ${user.id} + '\');'">
                                    <td th:text="${user.firstName + ' ' + user.lastName}">[user.firstName + user.lastName]</td>
                                    <td th:text="${user.email}">[user.email]</td>
                                    <td>[user.phone]</td>
                                    <td>[[${#dates.format(#dates.createNow(), 'dd MMM yyyy HH:mm')}]]</td>
                                    <td>
                                    	<span th:text="${user.enabled}? 'ativada' : 'desativada'" th:class="${user.enabled}? 'label label-primary' : 'label label-danger'" class="label label-primary">[user.enabled]</span>
                                    </td>
                                    <td>[user.roles]</td>

                                    <td class="text-right">
                                        <div class="btn-group">
                                        	<a href="#" th:href="@{/users/}" class="btn-white btn btn-xs" role="button">View</a>
                                            <a href="#" th:href="@{/users/edit/} + ${user.id}" class="btn-white btn btn-xs" role="button">Edit</a>
                                            <a href="#" th:onclick="'deleteUser(\'' + ${user.id} + '\');'" class="btn-white btn btn-xs" role="button">Delete</a>
                                        </div>
                                    </td>
                                </tr>
                                
                                </tbody>
                                <tfoot>
                                <tr>
                                    <td colspan="7">
                                        <ul class="pagination pull-right"></ul>
                                    </td>
                                </tr>
                                </tfoot>
                            </table>

                        </div>
                    </div>
                </div>
            </div>
            
        </div>
		
		<!-- APP Footer -->
		<div th:replace="fragments :: footer"></div>
	</div>
</div>
	
	<!--/* Placeholder for mainly scripts */-->
	<th:block th:include="fragments/scripts :: common_scripts" />

	<!-- FooTable -->
	<script src="js/plugins/footable/footable.all.min.js" th:src="@{/resources/js/plugins/footable/footable.all.min.js}"></script>
	
	<!-- Sweet alert -->
    <script src="js/plugins/sweetalert/sweetalert.min.js" th:src="@{/resources/js/plugins/sweetalert/sweetalert.min.js}"></script>

	<!-- Page-Level Scripts -->
    <script>
        $(document).ready(function() {
            $('.footable').footable();

        });

        function getRoles(id) {
        	var url = '[[@{/users/}]]' + id;
        	$("#user1").load(url); 
        }
        
        function deleteUser(id) {
        	swal({
                title: "Are you sure?",
                text: "You will not be able to recover this imaginary file!",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "Yes, delete it!",
                closeOnConfirm: false
            }, function () {
            	$.ajax(
            		{
                    	type : "GET",
                    	url : '[[@{/users/delete/}]]' + id,
                    	success : function(response) {
                    	}
            		}
            	)
            	.done(function(response) {
            		swal("Deleted!", "User [user.firstName] has been deleted.", "success");
            		$('#teste').load(document.URL +  ' #teste');
            	})
            	.error(function(response) {
            		swal("Oops", "We couldn't connect to the server!", "error");
            	}); 
            });
        }
        	
    </script>

</body>
</html>